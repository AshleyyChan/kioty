<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ðŸ•“ Optimization History</title>
  <link rel="stylesheet" href="style.css" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body {
      transition: background 0.3s ease, color 0.3s ease;
    }

    /* Dark Mode */
    body.dark {
      background-color: #121212;
      color: #f1f1f1;
    }

    /* Session Card */
    .session-card {
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      margin-bottom: 1rem;
      opacity: 0;
      transform: translateY(20px);
      animation: fadeSlideIn 0.4s ease forwards;
      background-color: #ffffff;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .session-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 4px 14px rgba(0,0,0,0.12);
    }

    /* Dark mode card with glow */
    body.dark .session-card {
      background-color: #1e1e1e;
      color: #f1f1f1;
      border: 1px solid #333;
      box-shadow: 0 0 10px rgba(0, 255, 180, 0.15);
    }

    /* Glow for headings in dark mode */
    body.dark h5 {
      text-shadow: 0 0 4px rgba(0, 255, 180, 0.6);
    }

    /* Item List */
    .list-group-item {
      background: transparent;
      border: none;
      padding: 6px 0;
    }

    body.dark .list-group-item {
      color: #ddd;
      border-bottom: 1px solid rgba(255,255,255,0.05);
    }

    /* Fade + slide animation */
    @keyframes fadeSlideIn {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Loader */
    #loader {
      color: inherit;
    }

    /* Empty State */
    .empty-message {
      text-align: center;
      margin-top: 2rem;
      font-style: italic;
      opacity: 0.8;
    }
  </style>
</head>
<body class="light">

  <div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h2>ðŸ“œ Optimization History</h2>
      <div class="form-check form-switch">
        <input class="form-check-input" type="checkbox" id="themeToggle" />
        <label class="form-check-label" for="themeToggle">Dark Mode</label>
      </div>
    </div>

    <div id="historyContainer"></div>

    <div id="loader" class="text-center my-4" style="display: none;">
      <div class="spinner-border text-primary" role="status"></div>
      <p class="mt-2">Loading history...</p>
    </div>
  </div>

  <script>
    const historyContainer = document.getElementById("historyContainer");
    const themeToggle = document.getElementById("themeToggle");
    const loader = document.getElementById("loader");
    const body = document.body;

    // Theme toggle
    themeToggle.addEventListener("change", () => {
      body.classList.toggle("dark");
      body.classList.toggle("light");
    });

    // Load history from backend
    async function loadHistory() {
      loader.style.display = "block";
      try {
        const response = await fetch("http://localhost:5000/history");
        const data = await response.json();
        loader.style.display = "none";

        if (!data.history || data.history.length === 0) {
          historyContainer.innerHTML = "<p class='empty-message'>No history available yet.</p>";
          return;
        }

        data.history.forEach((session, i) => {
          const div = document.createElement("div");
          div.className = "card session-card p-3";

          div.innerHTML = `
            <h5>Session #${i + 1} â€” <code>${session.sessionId}</code></h5>
            <p><strong>Date:</strong> ${new Date(session.timestamp).toLocaleString()}</p>
            <p><strong>Budget:</strong> â‚¹${session.budget}</p>
            <p><strong>Total Price:</strong> â‚¹${session.totalPrice}</p>
            <p><strong>Total Value:</strong> â‚¹${session.totalValue}</p>
            <p><strong>Items Selected:</strong> ${session.count}</p>
            <ul class="list-group mt-2">
              ${session.selectedItems.map(item =>
                `<li class="list-group-item">${item.name} â€” â‚¹${item.price}, Value: ${item.value}</li>`).join("")}
            </ul>
          `;
          historyContainer.appendChild(div);
        });

      } catch (err) {
        loader.style.display = "none";
        console.error("Failed to fetch history:", err);
        historyContainer.innerHTML = "<p class='text-danger text-center'>âš  Failed to load history.</p>";
      }
    }

    loadHistory();
  </script>
</body>
</html>
